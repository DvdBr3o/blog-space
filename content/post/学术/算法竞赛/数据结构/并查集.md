---
tags:
  - algorithm
  - æ•°æ®ç»“æ„
dg-publish: "true"
title: å¹¶æŸ¥é›†
date: 2024-11-24T23:31:44+08:00
lastmod: 2024-12-04T17:19:59+08:00
publish: true
---
## å®šä¹‰

æ ‘çŠ¶ç»“æ„ï¼Œæ”¯æŒä¸¤ç§æ“ä½œï¼š

+ åˆå¹¶
+ æŸ¥è¯¢ï¼šæ˜¯å¦åœ¨åŒä¸€é›†åˆ

ç”±äºå…¶æŸ¥è¯¢åŠŸèƒ½ï¼Œå¹¶æŸ¥é›†å¸¸ç”¨äº**æ£€æŸ¥å›¾ã®è¿é€šæ€§**ã€‚

> [!ATTENTION]
> 
> æ³¨æ„æœ‰äº›é¢˜ç›®ä½¿ç”¨ 1~n ç¼–å·è€Œä¸æ˜¯ 0 ~ n-1ï¼Œå›¾è®ºé—®é¢˜éƒ½è¦æ³¨æ„ç¼–å·é—®é¢˜ï¼Œå¦åˆ™ï¼š
> + æ•°ç»„è¶Šç•Œè®¿é—® $\Rightarrow$ RE
> + é€»è¾‘é”™è¯¯ $\Rightarrow$ WA

## å®ç° | æ— å‘å›¾

### ç»“æ„

å¼€æ•°ç»„æ± åŒ–é¿å… `new/delete` .

```cpp
struct Dsu {
	using ID = size_t;
	std::vector<ID> pa; // parent
	std::vector<size_t> size; // å¯å‘å¼åˆå¹¶ç»´æŠ¤ size

	Dsu(size_t sz) : pa(sz), size(sz, 1) { 
		std::iota(pa.begin(), pa.end(), 0); // [^1] 
	}
};

// [^1]: Set parent as self, so that every node is a root.
```

### æŸ¥è¯¢

> [!note] æœ´ç´ åšæ³•
> å¦‚ä¸‹
> ```cpp
> auto Dsu::find(ID x) -> ID { return pa[x] == x ? x : find(pa[x]); }
> ```
> 
> å¯ä»¥ç”¨è·¯å¾„å‹ç¼©å‡å°‘å¯»çˆ¶æ¬¡æ•°åˆ° 1ã€‚

> [!note] è·¯å¾„å‹ç¼©
> 
> å³æŠŠæ ‘ç»“æ„æ‰å¹³åŒ–
> 
> ![disjoint-set-compress.svg](./assets/disjoint-set-compress.svg)

```cpp
// with è·¯å¾„å‹ç¼©
auto Dsu::find(ID x) -> ID { return pa[x] == x ? x : pa[x] = find(pa[x]); }
```

> [!warning]
> è·¯å¾„å‹ç¼©ä¸€æ¬¡å¯èƒ½ä¼šé€ æˆå¤§é‡ä¿®æ”¹ï¼Œå¹¶é lazyã€‚å› æ­¤æœ‰æ—¶å€™è·¯å¾„å‹ç¼©å¹¶ä¸é€‚åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š
> 
> + å¯æŒä¹…åŒ–å¹¶æŸ¥é›†
> + çº¿æ®µæ ‘åˆ†æ²» + å¹¶æŸ¥é›†
> 
> è¿™ç§æƒ…å†µä¸€èˆ¬ä½¿ç”¨**åªåŒ…å«å¯å‘å¼åˆå¹¶**çš„å¹¶æŸ¥é›†

### åˆå¹¶

åªéœ€å°†å…¶ä¸­ä¸€ä¸ªæ ‘çš„æ ¹æ¥åˆ°å¦ä¸€ä¸ªæ ¹ä¸Šå³å¯ã€‚

```mermaid
graph LR
2 --> 1
3 --> 1
4 --> 3
5 --> 3

7 --> 6
8 --> 6

6 -.-> 1
```

> [!note] å¯å‘å¼åˆå¹¶
> **ç‚¹æ•°**/**æ·±åº¦**ä»»é€‰å…¶ä¸€ç»´æŠ¤ä½œä¸º**ä¼°ä»·å‡½æ•°**ã€‚
> ä¸ºäº†é˜²æ­¢é€€åŒ–ï¼Œé™ä½å¤æ‚åº¦ï¼Œä¸€èˆ¬é€‰æ‹©å°†èŠ‚ç‚¹å°‘çš„æ ¹è¿åˆ°å¦ä¸€æ£µæ ‘
> ä¸€èˆ¬åªä½¿ç”¨è·¯å¾„å‹ç¼©è€Œä¸ä½¿ç”¨å¯å‘å¼åˆå¹¶ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šè¶…æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦èƒ½è¾¾åˆ° $O(m\alpha(m, n))$ã€‚
> å¦‚æœåªä½¿ç”¨å¯å‘å¼åˆå¹¶è€Œä¸ä½¿ç”¨è·¯å¾„å‹ç¼©ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(m\log{n})$ã€‚å› ä¸ºè·¯å¾„å‹ç¼©å¹¶ä¸æ˜¯ä»€ä¹ˆæ—¶å€™éƒ½èƒ½ç”¨ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¹Ÿè¦è€ƒè™‘ã€‚
> ç®€è€Œè¨€ä¹‹ï¼š
> + è·¯å¾„å‹ç¼© + å¯å‘å¼åˆå¹¶ï¼š$O(\alpha(n))$
> + è·¯å¾„å‹ç¼© onlyï¼š$O(m\alpha(m, n))$
> + å¯å‘å¼åˆå¹¶ only: $O(m\log{n})$ ç”¨äºä¸èƒ½ä½¿ç”¨è·¯å¾„å‹ç¼©æ—¶
> + éƒ½ä¸ç”¨ï¼š:LiCross:

```cpp
// with å¯å‘å¼åˆå¹¶ ç»´æŠ¤ç‚¹æ•°
auto Dsu::unite(size_t x, size_t y) -> void {
	x = find(x);
	y = find(y);
	if (x == y) return;
	if (size[x] < size[y]) std::swap(x, y);
	pa[y] = x;
	size[x] += size[y];
}
```

### åˆ é™¤

åªèƒ½ç”¨äºå¶ç»“ç‚¹ã€‚

```cpp
auto Dsu::erase(ID x) -> void {
	size[find(x)]--;
	pa[x] = x;
}
```

å¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ¶ä½œå‰¯æœ¬ï¼Œå°†å…¶å‰¯æœ¬ä½œä¸ºçˆ¶äº²ã€‚

### ç§»åŠ¨

åªèƒ½ç”¨äºå¶ç»“ç‚¹ã€‚

```cpp
auto Dsu::move(ID from, ID to) -> void {
	auto pa_from = find(from);
	auto pa_to = find(to);
	if (pa_from == pa_to) return;
	size[pa_from]--;
	size[pa_to]++;
}
```


## ä¹ é¢˜ TODO

- [ ] [P1525 [NOIP2010 æé«˜ç»„] å…³æŠ¼ç½ªçŠ¯](https://www.luogu.com.cn/problem/P1525) (@2024-12-11) ğŸ“… (due_date:: 2024-11-26) 

## å®ç° | æœ‰å‘å›¾æ±‚æœ€å°ç¯

### ç»“æ„

```cpp
struct Dsu {
	std::vector<size_t> pa;
	std::vector<size_t> dist; // ç»´æŠ¤åˆ°ç¥–å…ˆçš„è·ç¦»

	Dsu(size_t n) : pa(n + 1), dist(n + 1, 0) { 
		std::iota(pa.begin(), pa.end(), 0); 
	}
};
```

### æŸ¥è¯¢

```cpp
auto Dsu::find(size_t x) -> size_t {
	if (x != pa[x]) {
		size_t last = pa[x];
		pa[x] = find(pa[x]);
		dist[x] += dist[last];
	}
	return pa[x];
}
```

### åˆå¹¶

```cpp
size_t Dsu::min_ring_len = std::numeric_limits<size_t>::max();

auto Dsu::unite(size_t from, size_t to) -> void {
	auto f_from = find(from);
	auto f_to = find(to);
	if (f_from != f_to) {
		pa[f_to] = f_from;
		dist[to] = dist[from] + 1;
	} else {
		min_ring_len = std::min(min_ring_len, dist[from] + dist[to] + 1);
	}
}
```

## å®ç° | æ›´å¤šåº”ç”¨


```cardlink
url: https://oi-wiki.org/topic/dsu-app/
title: "å¹¶æŸ¥é›†åº”ç”¨ - OI Wiki"
description: "OI Wiki æ˜¯ä¸€ä¸ªç¼–ç¨‹ç«èµ›çŸ¥è¯†æ•´åˆç«™ç‚¹ï¼Œæä¾›æœ‰è¶£åˆå®ç”¨çš„ç¼–ç¨‹ç«èµ›çŸ¥è¯†ä»¥åŠå…¶ä»–æœ‰å¸®åŠ©çš„å†…å®¹ï¼Œå¸®åŠ©å¹¿å¤§ç¼–ç¨‹ç«èµ›çˆ±å¥½è€…æ›´å¿«æ›´æ·±å…¥åœ°å­¦ä¹ ç¼–ç¨‹ç«èµ›"
host: oi-wiki.org
favicon: ../../favicon.ico
```

